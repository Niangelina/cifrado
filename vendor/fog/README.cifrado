Portions of Fog (http://fog.io) vendored

All the changes required, if any are, submitted upstream.
